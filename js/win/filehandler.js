// koffee 1.14.0

/*
00000000  000  000      00000000  000   000   0000000   000   000  0000000    000      00000000  00000000 
000       000  000      000       000   000  000   000  0000  000  000   000  000      000       000   000
000000    000  000      0000000   000000000  000000000  000 0 000  000   000  000      0000000   0000000  
000       000  000      000       000   000  000   000  000  0000  000   000  000      000       000   000
000       000  0000000  00000000  000   000  000   000  000   000  0000000    0000000  00000000  000   000
 */
var File, FileHandler, _, electron, empty, filelist, first, kerror, post, prefs, ref, reversed, slash, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), _ = ref._, empty = ref.empty, filelist = ref.filelist, first = ref.first, kerror = ref.kerror, post = ref.post, prefs = ref.prefs, reversed = ref.reversed, slash = ref.slash, valid = ref.valid;

File = require('../tools/file');

electron = require('electron');

FileHandler = (function() {
    function FileHandler() {
        this.saveFileAs = bind(this.saveFileAs, this);
        this.openFile = bind(this.openFile, this);
        this.saveChanges = bind(this.saveChanges, this);
        this.saveFile = bind(this.saveFile, this);
        this.saveAll = bind(this.saveAll, this);
        this.removeFile = bind(this.removeFile, this);
        this.reloadFile = bind(this.reloadFile, this);
        this.reloadTab = bind(this.reloadTab, this);
        this.openFiles = bind(this.openFiles, this);
        this.loadFile = bind(this.loadFile, this);
        post.on('reloadFile', this.reloadFile);
        post.on('removeFile', this.removeFile);
        post.on('saveFileAs', this.saveFileAs);
        post.on('saveFile', this.saveFile);
        post.on('saveAll', this.saveAll);
        post.on('saveChanges', this.saveChanges);
        post.on('reloadTab', this.reloadTab);
        post.on('loadFile', this.loadFile);
        post.on('openFile', this.openFile);
        post.on('openFiles', this.openFiles);
    }

    FileHandler.prototype.loadFile = function(file, opt) {
        var activeTab, err, fileExists, filePos, ref1, tab;
        if (opt == null) {
            opt = {};
        }
        if ((file != null) && file.length <= 0) {
            file = null;
        }
        editor.saveScrollCursorsAndSelections();
        if (file != null) {
            ref1 = slash.splitFilePos(file), file = ref1[0], filePos = ref1[1];
            if (!file.startsWith('untitled')) {
                file = slash.resolve(file);
                try {
                    process.chdir(slash.dir(file));
                } catch (error) {
                    err = error;
                    kerror(err);
                }
            }
        }
        if (file !== (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) || (opt != null ? opt.reload : void 0)) {
            if (fileExists = slash.fileExists(file)) {
                this.addToRecent(file);
            }
            tab = tabs.tab(file);
            if (empty(tab)) {
                tab = tabs.addTab(file);
            }
            if (activeTab = tabs.activeTab()) {
                if (tab !== activeTab) {
                    activeTab.clearActive();
                    if (activeTab.dirty) {
                        activeTab.storeState();
                    }
                }
            }
            editor.setCurrentFile(file);
            tab.finishActivation();
            editor.restoreScrollCursorsAndSelections();
            if (fileExists) {
                post.toOtherWins('fileLoaded', file);
                post.emit('cwdSet', slash.dir(file));
            }
        }
        split.raise('editor');
        if ((filePos != null) && (filePos[0] || filePos[1])) {
            editor.singleCursorAtPos(filePos);
            return editor.scroll.cursorToTop();
        }
    };

    FileHandler.prototype.openFiles = function(ofiles, options) {
        var answer, file, files, i, len;
        if (ofiles != null ? ofiles.length : void 0) {
            files = filelist(ofiles, {
                ignoreHidden: false
            });
            if (files.length >= 10) {
                answer = dialog.showMessageBox({
                    type: 'warning',
                    buttons: ['Cancel', 'Open All'],
                    defaultId: 0,
                    cancelId: 0,
                    title: 'A Lot of Files Warning',
                    message: "You have selected " + files.length + " files.",
                    detail: 'Are you sure you want to open that many files?'
                });
                if (answer !== 1) {
                    return;
                }
            }
            if (files.length === 0) {
                return [];
            }
            window.stash.set('openFilePath', slash.dir(files[0]));
            if (!(options != null ? options.newWindow : void 0) && !(options != null ? options.newTab : void 0)) {
                file = slash.resolve(files.shift());
                this.loadFile(file);
            }
            for (i = 0, len = files.length; i < len; i++) {
                file = files[i];
                if (options != null ? options.newWindow : void 0) {
                    post.toMain('newWindowWithFile', file);
                } else {
                    post.emit('newTabWithFile', file);
                }
            }
            return ofiles;
        }
    };

    FileHandler.prototype.reloadTab = function(file) {
        if (file === (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0)) {
            return this.loadFile(typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0, {
                reload: true
            });
        } else {
            return post.emit('revertFile', file);
        }
    };

    FileHandler.prototype.reloadFile = function(file) {
        var tab;
        if (!file) {
            return this.reloadActiveTab();
        } else if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                return this.reloadActiveTab();
            } else {
                return tab.reload();
            }
        }
    };

    FileHandler.prototype.reloadActiveTab = function() {
        var tab;
        if (tab = tabs.activeTab()) {
            tab.reload();
        }
        this.loadFile(editor.currentFile, {
            reload: true
        });
        if (editor.currentFile != null) {
            return post.toOtherWins('reloadTab', editor.currentFile);
        }
    };

    FileHandler.prototype.removeFile = function(file) {
        var neighborTab, tab;
        if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                if (neighborTab = tab.nextOrPrev()) {
                    neighborTab.activate();
                }
            }
            return tabs.closeTab(tab);
        }
    };

    FileHandler.prototype.saveAll = function() {
        var i, len, ref1, results, tab;
        ref1 = tabs.tabs;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
            tab = ref1[i];
            if (tab.dirty) {
                if (tab === tabs.activeTab()) {
                    results.push(this.saveFile(tab.file));
                } else {
                    if (!tab.file.startsWith('untitled')) {
                        results.push(tab.saveChanges());
                    } else {
                        results.push(void 0);
                    }
                }
            } else {
                results.push(void 0);
            }
        }
        return results;
    };

    FileHandler.prototype.saveFile = function(file) {
        var err, tabState;
        if (file != null) {
            file;
        } else {
            file = editor.currentFile;
        }
        if ((file == null) || file.startsWith('untitled')) {
            this.saveFileAs();
            return;
        }
        post.emit('unwatch', file);
        tabState = editor["do"].tabState();
        try {
            post.emit('menuAction', 'doMacro', {
                actarg: 'req'
            });
        } catch (error) {
            err = error;
            kerror("macro req failed " + err);
        }
        return File.save(file, editor.text(), function(err, saved) {
            editor.saveScrollCursorsAndSelections();
            if (valid(err)) {
                kerror("saving '" + file + "' failed:", err);
            } else {
                editor.setCurrentFile(saved);
                editor["do"].history = tabState.history;
                editor["do"].saveIndex = tabState.history.length;
                post.toOtherWins('fileSaved', saved, window.winID);
                post.emit('saved', saved);
                post.emit('watch', saved);
            }
            return editor.restoreScrollCursorsAndSelections();
        });
    };

    FileHandler.prototype.addToRecent = function(file) {
        var recent;
        recent = window.state.get('recentFiles', []);
        if (file === first(recent)) {
            return;
        }
        _.pull(recent, file);
        recent.unshift(file);
        while (recent.length > prefs.get('recentFilesLength', 15)) {
            recent.pop();
        }
        window.state.set('recentFiles', recent);
        return commandline.commands.open.setHistory(reversed(recent));
    };

    FileHandler.prototype.saveChanges = function() {
        if ((editor.currentFile != null) && editor["do"].hasChanges() && slash.fileExists(editor.currentFile)) {
            return File.save(editor.currentFile, editor.text(), function(err) {
                if (err) {
                    return kerror("FileHandler.saveChanges failed " + err);
                }
            });
        }
    };

    FileHandler.prototype.openFile = function(opt) {
        var dir;
        if (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) {
            dir = slash.dir(editor.currentFile);
        }
        if (dir != null) {
            dir;
        } else {
            dir = slash.resolve('.');
        }
        return dialog.showOpenDialog({
            title: "Open File",
            defaultPath: window.stash.get('openFilePath', dir),
            properties: ['openFile', 'multiSelections']
        }).then((function(_this) {
            return function(result) {
                if (!result.cancelled && valid(result.filePaths)) {
                    return post.emit('openFiles', result.filePaths, opt);
                }
            };
        })(this));
    };

    FileHandler.prototype.saveFileAs = function() {
        var defaultPath;
        defaultPath = slash.unslash(typeof editor !== "undefined" && editor !== null ? editor.currentDir() : void 0);
        return dialog.showSaveDialog({
            title: 'Save File As',
            defaultPath: defaultPath
        }).then((function(_this) {
            return function(result) {
                if (!result.cancelled && result.filePath) {
                    _this.addToRecent(result.filePath);
                    return _this.saveFile(result.filePath);
                }
            };
        })(this));
    };

    return FileHandler;

})();

module.exports = FileHandler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZWhhbmRsZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vY29mZmVlL3dpbiIsInNvdXJjZXMiOlsiZmlsZWhhbmRsZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLHdHQUFBO0lBQUE7O0FBUUEsTUFBNkUsT0FBQSxDQUFRLEtBQVIsQ0FBN0UsRUFBRSxTQUFGLEVBQUssaUJBQUwsRUFBWSx1QkFBWixFQUFzQixpQkFBdEIsRUFBNkIsbUJBQTdCLEVBQXFDLGVBQXJDLEVBQTJDLGlCQUEzQyxFQUFrRCx1QkFBbEQsRUFBNEQsaUJBQTVELEVBQW1FOztBQUVuRSxJQUFBLEdBQVcsT0FBQSxDQUFRLGVBQVI7O0FBQ1gsUUFBQSxHQUFXLE9BQUEsQ0FBUSxVQUFSOztBQUVMO0lBRUMscUJBQUE7Ozs7Ozs7Ozs7O1FBRUMsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXNCLElBQUMsQ0FBQSxVQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsWUFBUixFQUFzQixJQUFDLENBQUEsVUFBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFlBQVIsRUFBc0IsSUFBQyxDQUFBLFVBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxVQUFSLEVBQXNCLElBQUMsQ0FBQSxRQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsU0FBUixFQUFzQixJQUFDLENBQUEsT0FBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLGFBQVIsRUFBc0IsSUFBQyxDQUFBLFdBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxXQUFSLEVBQXNCLElBQUMsQ0FBQSxTQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsVUFBUixFQUFzQixJQUFDLENBQUEsUUFBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFVBQVIsRUFBc0IsSUFBQyxDQUFBLFFBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxXQUFSLEVBQXNC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QixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwICAgICAgMDAwMDAwMDAgIDAwMDAwMDAwIFxuMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIFxuMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuIyMjXG5cbnsgXywgZW1wdHksIGZpbGVsaXN0LCBmaXJzdCwga2Vycm9yLCBwb3N0LCBwcmVmcywgcmV2ZXJzZWQsIHNsYXNoLCB2YWxpZCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5GaWxlICAgICA9IHJlcXVpcmUgJy4uL3Rvb2xzL2ZpbGUnXG5lbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuXG5jbGFzcyBGaWxlSGFuZGxlclxuXG4gICAgQDogLT5cblxuICAgICAgICBwb3N0Lm9uICdyZWxvYWRGaWxlJyAgQHJlbG9hZEZpbGVcbiAgICAgICAgcG9zdC5vbiAncmVtb3ZlRmlsZScgIEByZW1vdmVGaWxlXG4gICAgICAgIHBvc3Qub24gJ3NhdmVGaWxlQXMnICBAc2F2ZUZpbGVBc1xuICAgICAgICBwb3N0Lm9uICdzYXZlRmlsZScgICAgQHNhdmVGaWxlXG4gICAgICAgIHBvc3Qub24gJ3NhdmVBbGwnICAgICBAc2F2ZUFsbFxuICAgICAgICBwb3N0Lm9uICdzYXZlQ2hhbmdlcycgQHNhdmVDaGFuZ2VzXG4gICAgICAgIHBvc3Qub24gJ3JlbG9hZFRhYicgICBAcmVsb2FkVGFiXG4gICAgICAgIHBvc3Qub24gJ2xvYWRGaWxlJyAgICBAbG9hZEZpbGVcbiAgICAgICAgcG9zdC5vbiAnb3BlbkZpbGUnICAgIEBvcGVuRmlsZVxuICAgICAgICBwb3N0Lm9uICdvcGVuRmlsZXMnICAgQG9wZW5GaWxlc1xuICAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBsb2FkRmlsZTogKGZpbGUsIG9wdD17fSkgPT5cbiAgICBcbiAgICAgICAgZmlsZSA9IG51bGwgaWYgZmlsZT8gYW5kIGZpbGUubGVuZ3RoIDw9IDBcbiAgICBcbiAgICAgICAgZWRpdG9yLnNhdmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgXG4gICAgICAgIGlmIGZpbGU/XG4gICAgICAgICAgICBbZmlsZSwgZmlsZVBvc10gPSBzbGFzaC5zcGxpdEZpbGVQb3MgZmlsZVxuICAgICAgICAgICAgaWYgbm90IGZpbGUuc3RhcnRzV2l0aCAndW50aXRsZWQnXG4gICAgICAgICAgICAgICAgZmlsZSA9IHNsYXNoLnJlc29sdmUgZmlsZVxuICAgICAgICAgICAgICAgIHRyeVxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmNoZGlyIHNsYXNoLmRpciBmaWxlXG4gICAgICAgICAgICAgICAgY2F0Y2ggZXJyXG4gICAgICAgICAgICAgICAgICAgIGtlcnJvciBlcnJcbiAgICBcbiAgICAgICAgaWYgZmlsZSAhPSBlZGl0b3I/LmN1cnJlbnRGaWxlIG9yIG9wdD8ucmVsb2FkXG4gICAgXG4gICAgICAgICAgICBpZiBmaWxlRXhpc3RzID0gc2xhc2guZmlsZUV4aXN0cyBmaWxlXG4gICAgICAgICAgICAgICAgQGFkZFRvUmVjZW50IGZpbGVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGFiID0gdGFicy50YWIgZmlsZVxuICAgICAgICAgICAgaWYgZW1wdHkgdGFiXG4gICAgICAgICAgICAgICAgdGFiID0gdGFicy5hZGRUYWIgZmlsZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBhY3RpdmVUYWIgPSB0YWJzLmFjdGl2ZVRhYigpXG4gICAgICAgICAgICAgICAgaWYgdGFiICE9IGFjdGl2ZVRhYlxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVUYWIuY2xlYXJBY3RpdmUoKVxuICAgICAgICAgICAgICAgICAgICBpZiBhY3RpdmVUYWIuZGlydHlcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYi5zdG9yZVN0YXRlKClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGVkaXRvci5zZXRDdXJyZW50RmlsZSBmaWxlXG4gICAgXG4gICAgICAgICAgICB0YWIuZmluaXNoQWN0aXZhdGlvbigpICMgc2V0QWN0aXZlLCByZXN0b3JlIHN0YXRlLCB1cGRhdGUgdGFic1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3IucmVzdG9yZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgZmlsZUV4aXN0c1xuICAgICAgICAgICAgICAgIHBvc3QudG9PdGhlcldpbnMgJ2ZpbGVMb2FkZWQnIGZpbGUgIyBpbmRleGVyXG4gICAgICAgICAgICAgICAgcG9zdC5lbWl0ICdjd2RTZXQnIHNsYXNoLmRpciBmaWxlXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHNwbGl0LnJhaXNlICdlZGl0b3InXG4gICAgXG4gICAgICAgIGlmIGZpbGVQb3M/IGFuZCAoZmlsZVBvc1swXSBvciBmaWxlUG9zWzFdKVxuICAgICAgICAgICAgZWRpdG9yLnNpbmdsZUN1cnNvckF0UG9zIGZpbGVQb3NcbiAgICAgICAgICAgIGVkaXRvci5zY3JvbGwuY3Vyc29yVG9Ub3AoKVxuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgMCAwMDAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgICAgMDAwXG4gICAgIyAgMDAwMDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDBcbiAgICBcbiAgICBvcGVuRmlsZXM6IChvZmlsZXMsIG9wdGlvbnMpID0+ICMgY2FsbGVkIGZyb20gZmlsZSBkaWFsb2csIG9wZW4gY29tbWFuZCBhbmQgYnJvd3NlclxuICAgIFxuICAgICAgICBpZiBvZmlsZXM/Lmxlbmd0aFxuICAgIFxuICAgICAgICAgICAgZmlsZXMgPSBmaWxlbGlzdCBvZmlsZXMsIGlnbm9yZUhpZGRlbjogZmFsc2VcbiAgICBcbiAgICAgICAgICAgIGlmIGZpbGVzLmxlbmd0aCA+PSAxMFxuICAgICAgICAgICAgICAgIGFuc3dlciA9IGRpYWxvZy5zaG93TWVzc2FnZUJveFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAgICAgICAnd2FybmluZydcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uczogICAgWydDYW5jZWwnICdPcGVuIEFsbCddXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRJZDogIDBcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsSWQ6ICAgMFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogICAgICAnQSBMb3Qgb2YgRmlsZXMgV2FybmluZydcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogICAgXCJZb3UgaGF2ZSBzZWxlY3RlZCAje2ZpbGVzLmxlbmd0aH0gZmlsZXMuXCJcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiAgICAgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBvcGVuIHRoYXQgbWFueSBmaWxlcz8nXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlmIGFuc3dlciAhPSAxXG4gICAgXG4gICAgICAgICAgICBpZiBmaWxlcy5sZW5ndGggPT0gMFxuICAgICAgICAgICAgICAgIHJldHVybiBbXVxuICAgIFxuICAgICAgICAgICAgd2luZG93LnN0YXNoLnNldCAnb3BlbkZpbGVQYXRoJyBzbGFzaC5kaXIgZmlsZXNbMF1cbiAgICBcbiAgICAgICAgICAgIGlmIG5vdCBvcHRpb25zPy5uZXdXaW5kb3cgYW5kIG5vdCBvcHRpb25zPy5uZXdUYWJcbiAgICAgICAgICAgICAgICBmaWxlID0gc2xhc2gucmVzb2x2ZSBmaWxlcy5zaGlmdCgpXG4gICAgICAgICAgICAgICAgQGxvYWRGaWxlIGZpbGVcbiAgICBcbiAgICAgICAgICAgIGZvciBmaWxlIGluIGZpbGVzXG4gICAgICAgICAgICAgICAgaWYgb3B0aW9ucz8ubmV3V2luZG93XG4gICAgICAgICAgICAgICAgICAgIHBvc3QudG9NYWluICduZXdXaW5kb3dXaXRoRmlsZScgZmlsZVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcG9zdC5lbWl0ICduZXdUYWJXaXRoRmlsZScgZmlsZVxuICAgIFxuICAgICAgICAgICAgcmV0dXJuIG9maWxlc1xuICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICByZWxvYWRUYWI6IChmaWxlKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgZmlsZSA9PSBlZGl0b3I/LmN1cnJlbnRGaWxlXG4gICAgICAgICAgICBAbG9hZEZpbGUgZWRpdG9yPy5jdXJyZW50RmlsZSwgcmVsb2FkOnRydWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC5lbWl0ICdyZXZlcnRGaWxlJyBmaWxlXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgICAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgcmVsb2FkRmlsZTogKGZpbGUpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgZmlsZVxuICAgICAgICAgICAgQHJlbG9hZEFjdGl2ZVRhYigpXG4gICAgICAgIGVsc2UgaWYgdGFiID0gdGFicy50YWIgZmlsZVxuICAgICAgICAgICAgaWYgdGFiID09IHRhYnMuYWN0aXZlVGFiKClcbiAgICAgICAgICAgICAgICBAcmVsb2FkQWN0aXZlVGFiKClcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0YWIucmVsb2FkKClcbiAgICAgICAgICAgIFxuICAgIHJlbG9hZEFjdGl2ZVRhYjogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIHRhYiA9IHRhYnMuYWN0aXZlVGFiKClcbiAgICAgICAgICAgIHRhYi5yZWxvYWQoKVxuICAgICAgICBcbiAgICAgICAgQGxvYWRGaWxlIGVkaXRvci5jdXJyZW50RmlsZSwgcmVsb2FkOnRydWVcbiAgICBcbiAgICAgICAgaWYgZWRpdG9yLmN1cnJlbnRGaWxlP1xuICAgICAgICAgICAgcG9zdC50b090aGVyV2lucyAncmVsb2FkVGFiJywgZWRpdG9yLmN1cnJlbnRGaWxlXG5cbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwICAgICAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgIDAgICAgICAwMDAwMDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIHJlbW92ZUZpbGU6IChmaWxlKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgdGFiID0gdGFicy50YWIgZmlsZVxuICAgICAgICAgICAgaWYgdGFiID09IHRhYnMuYWN0aXZlVGFiKClcbiAgICAgICAgICAgICAgICBpZiBuZWlnaGJvclRhYiA9IHRhYi5uZXh0T3JQcmV2KClcbiAgICAgICAgICAgICAgICAgICAgbmVpZ2hib3JUYWIuYWN0aXZhdGUoKVxuICAgICAgICAgICAgdGFicy5jbG9zZVRhYiB0YWJcbiAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMCAgXG4gICAgXG4gICAgc2F2ZUFsbDogPT5cbiAgICAgICAgXG4gICAgICAgIGZvciB0YWIgaW4gdGFicy50YWJzXG4gICAgICAgICAgICBpZiB0YWIuZGlydHkgXG4gICAgICAgICAgICAgICAgaWYgdGFiID09IHRhYnMuYWN0aXZlVGFiKClcbiAgICAgICAgICAgICAgICAgICAgQHNhdmVGaWxlIHRhYi5maWxlXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGFiLmZpbGUuc3RhcnRzV2l0aCAndW50aXRsZWQnXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWIuc2F2ZUNoYW5nZXMoKVxuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgc2F2ZUZpbGU6IChmaWxlKSA9PlxuICAgIFxuICAgICAgICBmaWxlID89IGVkaXRvci5jdXJyZW50RmlsZVxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGZpbGU/IG9yIGZpbGUuc3RhcnRzV2l0aCAndW50aXRsZWQnXG4gICAgICAgICAgICBAc2F2ZUZpbGVBcygpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgXG4gICAgICAgIHBvc3QuZW1pdCAndW53YXRjaCcgZmlsZVxuICAgICAgICBcbiAgICAgICAgdGFiU3RhdGUgPSBlZGl0b3IuZG8udGFiU3RhdGUoKVxuICAgICAgICBcbiAgICAgICAgdHJ5XG4gICAgICAgICAgICBwb3N0LmVtaXQgJ21lbnVBY3Rpb24nICdkb01hY3JvJyBhY3Rhcmc6J3JlcScgIyAhISEhISEhXG4gICAgICAgIGNhdGNoIGVyclxuICAgICAgICAgICAga2Vycm9yIFwibWFjcm8gcmVxIGZhaWxlZCAje2Vycn1cIlxuICAgICAgICBcbiAgICAgICAgRmlsZS5zYXZlIGZpbGUsIGVkaXRvci50ZXh0KCksIChlcnIsIHNhdmVkKSAtPlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3Iuc2F2ZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgdmFsaWQgZXJyXG4gICAgICAgICAgICAgICAga2Vycm9yIFwic2F2aW5nICcje2ZpbGV9JyBmYWlsZWQ6XCIgZXJyXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZWRpdG9yLnNldEN1cnJlbnRGaWxlICAgICBzYXZlZFxuICAgICAgICAgICAgICAgIGVkaXRvci5kby5oaXN0b3J5ICAgPSB0YWJTdGF0ZS5oaXN0b3J5XG4gICAgICAgICAgICAgICAgZWRpdG9yLmRvLnNhdmVJbmRleCA9IHRhYlN0YXRlLmhpc3RvcnkubGVuZ3RoXG4gICAgICAgICAgICAgICAgcG9zdC50b090aGVyV2lucyAnZmlsZVNhdmVkJyBzYXZlZCwgd2luZG93LndpbklEXG4gICAgICAgICAgICAgICAgIyBwb3N0LnRvTWFpbiAnZmlsZVNhdmVkJyBzYXZlZCwgd2luZG93LndpbklEXG4gICAgICAgICAgICAgICAgcG9zdC5lbWl0ICAgICAnc2F2ZWQnICAgICBzYXZlZFxuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAgICAgJ3dhdGNoJyAgICAgc2F2ZWRcblxuICAgICAgICAgICAgZWRpdG9yLnJlc3RvcmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgICAgICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAwICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAwMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgICAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgYWRkVG9SZWNlbnQ6IChmaWxlKSAtPlxuICAgIFxuICAgICAgICByZWNlbnQgPSB3aW5kb3cuc3RhdGUuZ2V0ICdyZWNlbnRGaWxlcycgW11cbiAgICAgICAgcmV0dXJuIGlmIGZpbGUgPT0gZmlyc3QgcmVjZW50XG4gICAgICAgIF8ucHVsbCByZWNlbnQsIGZpbGVcbiAgICAgICAgcmVjZW50LnVuc2hpZnQgZmlsZVxuICAgICAgICB3aGlsZSByZWNlbnQubGVuZ3RoID4gcHJlZnMuZ2V0ICdyZWNlbnRGaWxlc0xlbmd0aCcgMTVcbiAgICAgICAgICAgIHJlY2VudC5wb3AoKVxuICAgIFxuICAgICAgICB3aW5kb3cuc3RhdGUuc2V0ICdyZWNlbnRGaWxlcycgcmVjZW50XG4gICAgICAgICMgd2luZG93LnRpdGxlYmFyLnJlZnJlc2hNZW51KClcbiAgICAgICAgY29tbWFuZGxpbmUuY29tbWFuZHMub3Blbi5zZXRIaXN0b3J5IHJldmVyc2VkIHJlY2VudFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICAgXG4gICAgXG4gICAgc2F2ZUNoYW5nZXM6ID0+XG4gICAgICAgIFxuICAgICAgICBpZiBlZGl0b3IuY3VycmVudEZpbGU/IGFuZCBlZGl0b3IuZG8uaGFzQ2hhbmdlcygpIGFuZCBzbGFzaC5maWxlRXhpc3RzIGVkaXRvci5jdXJyZW50RmlsZVxuICAgICAgICAgICAgRmlsZS5zYXZlIGVkaXRvci5jdXJyZW50RmlsZSwgZWRpdG9yLnRleHQoKSwgKGVycikgLT5cbiAgICAgICAgICAgICAgICBrZXJyb3IgXCJGaWxlSGFuZGxlci5zYXZlQ2hhbmdlcyBmYWlsZWQgI3tlcnJ9XCIgaWYgZXJyXG4gICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAgICAgICAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBvcGVuRmlsZTogKG9wdCkgPT5cbiAgICBcbiAgICAgICAgZGlyID0gc2xhc2guZGlyIGVkaXRvci5jdXJyZW50RmlsZSBpZiBlZGl0b3I/LmN1cnJlbnRGaWxlXG4gICAgICAgIGRpciA/PSBzbGFzaC5yZXNvbHZlICcuJ1xuICAgICAgICBkaWFsb2cuc2hvd09wZW5EaWFsb2coXG4gICAgICAgICAgICB0aXRsZTogXCJPcGVuIEZpbGVcIlxuICAgICAgICAgICAgZGVmYXVsdFBhdGg6IHdpbmRvdy5zdGFzaC5nZXQgJ29wZW5GaWxlUGF0aCcgZGlyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBbJ29wZW5GaWxlJyAnbXVsdGlTZWxlY3Rpb25zJ10pLnRoZW4gKHJlc3VsdCkgPT5cbiAgICAgICAgICAgICAgICBpZiBub3QgcmVzdWx0LmNhbmNlbGxlZCBhbmQgdmFsaWQgcmVzdWx0LmZpbGVQYXRoc1xuICAgICAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ29wZW5GaWxlcycgcmVzdWx0LmZpbGVQYXRocywgb3B0XG4gICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgICAgMDAwMDAwMCAgICAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwICAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgICAgMDAwMDAwMDAwICAwMDAwMDAwICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuICAgIFxuICAgIHNhdmVGaWxlQXM6ID0+XG4gICAgXG4gICAgICAgIGRlZmF1bHRQYXRoID0gc2xhc2gudW5zbGFzaCBlZGl0b3I/LmN1cnJlbnREaXIoKVxuICAgICAgICBkaWFsb2cuc2hvd1NhdmVEaWFsb2codGl0bGU6J1NhdmUgRmlsZSBBcycgZGVmYXVsdFBhdGg6ZGVmYXVsdFBhdGgpLnRoZW4gKHJlc3VsdCkgPT5cbiAgICAgICAgICAgIGlmIG5vdCByZXN1bHQuY2FuY2VsbGVkIGFuZCByZXN1bHQuZmlsZVBhdGhcbiAgICAgICAgICAgICAgICBAYWRkVG9SZWNlbnQgcmVzdWx0LmZpbGVQYXRoXG4gICAgICAgICAgICAgICAgQHNhdmVGaWxlIHJlc3VsdC5maWxlUGF0aFxuICAgICAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IEZpbGVIYW5kbGVyXG4iXX0=
//# sourceURL=../../coffee/win/filehandler.coffee